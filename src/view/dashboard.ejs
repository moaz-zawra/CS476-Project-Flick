<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flick | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="p-4 bg-amber-200">

    <header>
        <div class="text-black font-extrabold text-center text-3xl font-mono">Flick</div>
        <div class="text-black font-extrabold text-center text-xl font-mono italic">Your Flashcards are a Click Away!</div>
        <hr class="border-black">
    </header>

    <br />
    <label for="disableDebug">Show Debug?</label><input id="disableDebug" type="checkbox" onclick='handleDebugCheck(this)'>

    <div class="flow-root">
        <span class="text-black text-2xl font-sans"> Welcome, <b> <%= user.username %> </b> </span>
        <span class="hidden text-red-500 debug italic"> userID: <%=uID%> email: <%=user.email%> role: <%=user.role%> </span>

        <button class="float-right border-2 rounded-xl w-25 p-0.5 bg-red-400 text-black font-bold hover:bg-red-500 border-black"
                onclick="window.location.href='/api/v2/logout'">Logout</button>
        <button class="float-right border-2 rounded-xl w-30 p-0.5 mr-2 bg-green-300 text-black font-bold hover:bg-green-400 border-black"
                onclick="window.location.href='/account'">Account Info</button>
    </div>

    <% if (status==="success" ) { %> <p style="color: limegreen;">Card set added successfully.</p>
    <% } else if (status==="name-used" ) { %> <p style="color: red;">You already have a flashcard set with that name</p>
    <% } else if (status==="missing-info" ) { %> <p style="color: red;">Information was missing from the request to create the flashcard. Please try again.</p>
    <% } else if (status==="error" ) { %> <p style="color: red;">An error has occurred</p> <% } %>

    <br />
    <div id=""


    <div id="ejs-flashcard">
        <span class="text-3xl font-bold">Flashcard Sets</span>
        <br />

        <% if (sets.length === 0) { %>
            <span class='text-1xl font-bold italic'> You have no sets. Create one using the button below!</span>
            <br /><br />
        <% } %>

        <button class="bg-sky-50 hover:bg-sky-100 text-gray-800 font-bold py-2 px-4 rounded-xl inline-flex items-center border-black" onclick="window.location.href='/newset'">
            <img style='padding-right:10px;' src="add.svg" alt="SVG Image"> <span>New Card Set</span>
        </button>
        <!-- The sets with tags displayed here -->
        <% if (sets.length > 0) { %>
            <input type="text" id="tagFilter" class="ml-2 py-1 px-2 text-center border-2 rounded-lg focus:outline-black border-gray-600 mt-1" placeholder="Search for a tag">
            <br /> <br />

        <% for (let i = 0; i < sets.length; i++) {%>
                <div class="inline-table w-fit bg-sky-50 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded-xl shadow">
                        <form action="/view_set" method="post">
                            <input type="hidden" name="set" value='<%= JSON.stringify(sets[i]) %>'>
                            <button type="submit" class="bg-green-100 hover:bg-green-200 text-gray-800 font-semibold mr-3 py-2 px-4 border border-gray-400 rounded-xl shadow">
                                <%= sets[i].setName %>
                            </button>
                        </form>

                    <hr class="border-t-1 border-black mt-1">
                        <span class="text-xs setTags"><%=sets[i].tags %></span><span class="hidden text-red-500 debug italic"> id#<%= sets[i].setID %> </span><br />
                        <form action="/edit_set" method="post">
                            <input type="hidden" name="set" value="<%= sets[i] %>">
                            <button class="bg-amber-100 hover:bg-amber-200 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded-xl shadow">
                                Edit
                            </button>
                        </form>
                        <form action="/edit_set" method="post">
                            <input type="hidden" name="set" value="<%= sets[i] %>">
                            <button class="bg-cyan-200 hover:bg-cyan-300 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded-xl shadow">
                                Share
                            </button>
                        </form>
                        <form action="/edit_set" method="post">
                            <input type="hidden" name="set" value="<%= sets[i] %>">
                            <button class="bg-red-500 hover:bg-red-600 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded-xl shadow">
                                Delete
                            </button>
                        </form>

                </div>
            <% } %>
        <% } %>
    </div>
        <script>

            function handleDebugCheck(checkbox) {
                document.querySelectorAll(".debug").forEach((element) => {
                    element.classList.toggle("hidden", !checkbox.checked);
                });
            }
            document.addEventListener("DOMContentLoaded", function () {
                const checkbox = document.getElementById("disableDebug");
                if (checkbox) {
                    checkbox.checked = false;
                    handleDebugCheck(checkbox);
                }
                document.getElementById("tagFilter").addEventListener("input", function(event) {
                    const value = event.target.value.toLowerCase();
                    const tags = document.getElementsByClassName("setTags");
                    for (let i = 0; i < tags.length; i++) {
                        const tagText = tags[i].innerHTML.toLowerCase();
                        if (tagText.includes(value)) {
                            tags[i].parentElement.parentElement.style.display = ""; // Show the set
                        } else {
                            tags[i].parentElement.parentElement.style.display = "none"; // Hide the set if it doesn't match
                        }
                    }
                });
            });
        </script>






</body>

</html>