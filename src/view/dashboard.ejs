<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flick | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/color-scheme.js"></script>
    <script src="/js/categories.js"></script>
    <script src="/js/status-handler.js"></script>
    <script src="/js/dashboard.js"></script>
    <script>
        tailwind.config = window.tailwindConfig;
    </script>
</head>
<body class="p-4 bg-bg-light dark:bg-bg-dark min-h-screen">

<%- include('partials/header') %>

<%- include('partials/status-message') %>

<div class="font-mono mt-7 text-2xl text-accent-light dark:text-accent-dark"> Welcome, <%= user.username %> </div>
<br />

<% if (role === 'admin') { %>
    <%- include('partials/admin_dashboard') %>
<% } else if (role === 'moderator') { %>
    <%- include('partials/mod_dashboard') %>
<% } else if (role === 'regular') { %>
    <%- include('partials/regular_dashboard') %>
<% } %>

<br />
</body>
</html>

<!-- Make data available to external JS file -->
<script>
    // Pass EJS data to global variables
    window.categoryNames = <%- JSON.stringify(categoryNames) %>;
    window.subcategoriesData = <%- JSON.stringify(subcategories) %>;
</script>

<!-- Include dashboard.js with all functionality -->
<script src="/js/dashboard.js"></script>

<!-- Initialize card sets -->
<% if (typeof userSets !== 'undefined' && Array.isArray(userSets)) { %>
    <% userSets.forEach(function(set, index) { %>
        <script>
            const setData<%= index %> = <%- JSON.stringify(set) %>;
            console.log(setData<%= index %>);
            insertSet(setData<%= index %>.setID, setData<%= index %>.setName, setData<%= index %>.category, setData<%= index %>.subCategory, false);
        </script>
    <% }); %>
<% } else { %>
    <script>
        console.log("No sets available to display");
    </script>
<% } %>
<% if (typeof sharedSets !== 'undefined' && Array.isArray(sharedSets)) { %>
    <% sharedSets.forEach(function(set, index) { %>
        <script>
            const sharedSetData<%= index %> = <%- JSON.stringify(set) %>;
            insertSet(sharedSetData<%= index %>.setID, sharedSetData<%= index %>.setName, sharedSetData<%= index %>.category, sharedSetData<%= index %>.subCategory, true);
        </script>
    <% }); %>
<% } else { %>
    <script>
        console.log("No shared sets available to display");
    </script>
<% } %>


